version: '3.3'

services:
  partdb:
    container_name: partdb
    build: .  # è®“ Docker ä½¿ç”¨ Dockerfile å»ºç«‹æ˜ åƒ
    restart: unless-stopped
    depends_on:
      - database
    ports:
      - "8080:80"
    volumes:
      - ./uploads:/var/www/html/uploads
      - ./public_media:/var/www/html/public/media
      - ./db:/var/www/html/var/db
    environment:
      # ðŸ“Œ è¨­å®šè³‡æ–™åº«é€£ç·š (ä¿®æ”¹ SECRET_USER_PASSWORD)
      - DATABASE_URL=mysql://partdb:SECRET_USER_PASSWORD@database:3306/partdb
      - APP_ENV=docker

      # ðŸŒ è¨­å®š Part-DB ä½¿ç”¨ç¹é«”ä¸­æ–‡
      - DEFAULT_LANG=zh
      # ðŸ•’ è¨­å®šæ™‚å€ç‚ºå°åŒ—
      - DEFAULT_TIMEZONE=Asia/Taipei
      # ðŸ’° è¨­å®šè²¨å¹£ç‚ºæ–°å°å¹£
      - BASE_CURRENCY=TWD
      # ðŸ”¹ è¨­å®š Part-DB ç¶²ç«™åç¨±
      - INSTANCE_NAME=é›¶ä»¶ç®¡ç†ç³»çµ±

      # å…è¨±ä½¿ç”¨è€…ä¸‹è¼‰é™„ä»¶
      - ALLOW_ATTACHMENT_DOWNLOADS=1
      - USE_GRAVATAR=0

  database:
    container_name: partdb_database
    image: mysql:8.0
    restart: unless-stopped
    command: >
      --default-authentication-plugin=mysql_native_password
      --log-bin-trust-function-creators=1
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
    environment:
      # ðŸ“Œ è¨­å®š MySQL å¸³è™Ÿå¯†ç¢¼ (è«‹ä¿®æ”¹ SECRET_*)
      MYSQL_ROOT_PASSWORD: SECRET_ROOT_PASSWORD
      MYSQL_DATABASE: partdb
      MYSQL_USER: partdb
      MYSQL_PASSWORD: SECRET_USER_PASSWORD
    volumes:
      - ./mysql:/var/lib/mysql
 
